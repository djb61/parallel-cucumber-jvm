[![Build Status](https://travis-ci.org/djb61/parallel-cucumber-jvm.svg?branch=master)](https://travis-ci.org/djb61/parallel-cucumber-jvm)
# Parallel Cucumber JVM
This is a wrapper around [cucumber-jvm](https://github.com/cucumber/cucumber-jvm) to allow parallel execution of tests at a feature level.

## Maven Artifact
Binaries are available in [jCenter](https://bintray.com/bintray/jcenter?filterByPkgName=parallel-cucumber-jvm)

[ ![Download](https://api.bintray.com/packages/djb61/maven/parallel-cucumber-jvm/images/download.svg) ](https://bintray.com/djb61/maven/parallel-cucumber-jvm/_latestVersion)
```
groupId:    com.bishnet
artifactId: parallel-cucumber-jvm 
```

## How to use it
To start a CLI test run use the main method in this class
``` java
com.bishnet.cucumber.parallel.cli.Main
```
The command line API matches that of cucumber-jvm as described [here](https://raw.githubusercontent.com/cucumber/cucumber-jvm/v1.2.2/core/src/main/resources/cucumber/api/cli/USAGE.txt).
Additional arguments are supported to control the level of parallelism and the way for sorting features between threads.
```
--num-threads <n> # Defaults to the number of available cores if not specified
--dynamic-feature-distribution # Disabled by default if not specified, allowing to split and run features in dynamic way
```

## Features

##### Thread timeline report

Report for simplify troubleshooting of multithreaded tests

![Report example](http://i.imgur.com/xfJfZAx.png)

Usage

``` java
--plugin thread-report:threadReportDir/
```

## Limitations
1. CLI is the only supported execution mechanism.
2. Specifying a rerun output formatter is not safe as all threads will attempt to update the same file. Specifying a rerun file as the input of scenarios to run is fine.
3. Only the cucumber-java backend has been tested. Other backends may or may not work correctly.

## How it works
1. The list of features to be executed is gathered based on the command line constraints provided.
2. The list of features is split into a number of chunks equal to the number of threads if the dynamic option is disabled and to the number of features if enabled.
3. Rerun formatted files are written to the JVM temp directory, one for each thread containing all the scenarios the thread should run if the dynamic option is disabled and one rerun file per feature if the option is enabled.
4. A cucumber-jvm runtime is started in each thread taking the temporary rerun file as input. If the dynamic option is enabled a number of cucumber-JVM runtimes will be dynamically split among threads by ExecutorService and executed as soon as any of the threads is
free. The output is written to an HTML and/or JSON report for the thread in the JVM temp directory dependent on the output formats requested on the command line.
5. The temporary HTML and/or JSON reports generated by the individual threads are merged into a single report and placed in the location specified on the command line.
